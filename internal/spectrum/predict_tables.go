// Copyright (c) 2025 Laurent Pelecq
// SPDX-License-Identifier: GPL-2.0-or-later

package spectrum

// Prediction constants for AAC MAIN profile intra-channel prediction.
// Ported from: ~/dev/faad2/libfaad/ic_predict.h:40-41
const (
	// predAlpha is the adaptation constant for variance/correlation update.
	predAlpha = float32(0.90625)

	// predA is the leakage factor for predictor state update.
	predA = float32(0.953125)
)

// mntTable is the mantissa lookup table for fast division approximation.
// Used to compute k1 and k2 coefficients in the predictor.
//
// Copied from: ~/dev/faad2/libfaad/ic_predict.h:49-114
var mntTable = [128]float32{
	0.9531250000, 0.9453125000, 0.9375000000, 0.9296875000,
	0.9257812500, 0.9179687500, 0.9101562500, 0.9023437500,
	0.8984375000, 0.8906250000, 0.8828125000, 0.8789062500,
	0.8710937500, 0.8671875000, 0.8593750000, 0.8515625000,
	0.8476562500, 0.8398437500, 0.8359375000, 0.8281250000,
	0.8242187500, 0.8203125000, 0.8125000000, 0.8085937500,
	0.8007812500, 0.7968750000, 0.7929687500, 0.7851562500,
	0.7812500000, 0.7773437500, 0.7734375000, 0.7656250000,
	0.7617187500, 0.7578125000, 0.7539062500, 0.7500000000,
	0.7421875000, 0.7382812500, 0.7343750000, 0.7304687500,
	0.7265625000, 0.7226562500, 0.7187500000, 0.7148437500,
	0.7109375000, 0.7070312500, 0.6992187500, 0.6953125000,
	0.6914062500, 0.6875000000, 0.6835937500, 0.6796875000,
	0.6796875000, 0.6757812500, 0.6718750000, 0.6679687500,
	0.6640625000, 0.6601562500, 0.6562500000, 0.6523437500,
	0.6484375000, 0.6445312500, 0.6406250000, 0.6406250000,
	0.6367187500, 0.6328125000, 0.6289062500, 0.6250000000,
	0.6210937500, 0.6210937500, 0.6171875000, 0.6132812500,
	0.6093750000, 0.6054687500, 0.6054687500, 0.6015625000,
	0.5976562500, 0.5937500000, 0.5937500000, 0.5898437500,
	0.5859375000, 0.5820312500, 0.5820312500, 0.5781250000,
	0.5742187500, 0.5742187500, 0.5703125000, 0.5664062500,
	0.5664062500, 0.5625000000, 0.5585937500, 0.5585937500,
	0.5546875000, 0.5507812500, 0.5507812500, 0.5468750000,
	0.5429687500, 0.5429687500, 0.5390625000, 0.5390625000,
	0.5351562500, 0.5312500000, 0.5312500000, 0.5273437500,
	0.5273437500, 0.5234375000, 0.5195312500, 0.5195312500,
	0.5156250000, 0.5156250000, 0.5117187500, 0.5117187500,
	0.5078125000, 0.5078125000, 0.5039062500, 0.5039062500,
	0.5000000000, 0.4980468750, 0.4960937500, 0.4941406250,
	0.4921875000, 0.4902343750, 0.4882812500, 0.4863281250,
	0.4843750000, 0.4824218750, 0.4804687500, 0.4785156250,
}

// expTable is the exponent lookup table for fast division approximation.
// Contains powers of 0.5: expTable[i] = 0.5^(i+1)
//
// Copied from: ~/dev/faad2/libfaad/ic_predict.h:116-245
var expTable = [128]float32{
	0.50000000000000000000000000000000,
	0.25000000000000000000000000000000,
	0.12500000000000000000000000000000,
	0.06250000000000000000000000000000,
	0.03125000000000000000000000000000,
	0.01562500000000000000000000000000,
	0.00781250000000000000000000000000,
	0.00390625000000000000000000000000,
	0.00195312500000000000000000000000,
	0.00097656250000000000000000000000,
	0.00048828125000000000000000000000,
	0.00024414062500000000000000000000,
	0.00012207031250000000000000000000,
	0.00006103515625000000000000000000,
	0.00003051757812500000000000000000,
	0.00001525878906250000000000000000,
	0.00000762939453125000000000000000,
	0.00000381469726562500000000000000,
	0.00000190734863281250000000000000,
	0.00000095367431640625000000000000,
	0.00000047683715820312500000000000,
	0.00000023841857910156250000000000,
	0.00000011920928955078125000000000,
	0.00000005960464477539062500000000,
	0.00000002980232238769531300000000,
	0.00000001490116119384765600000000,
	0.00000000745058059692382810000000,
	0.00000000372529029846191410000000,
	0.00000000186264514923095700000000,
	0.00000000093132257461547852000000,
	0.00000000046566128730773926000000,
	0.00000000023283064365386963000000,
	0.00000000011641532182693481000000,
	0.00000000005820766091346740700000,
	0.00000000002910383045673370400000,
	0.00000000001455191522836685200000,
	0.00000000000727595761418342590000,
	0.00000000000363797880709171300000,
	0.00000000000181898940354585650000,
	0.00000000000090949470177292824000,
	0.00000000000045474735088646412000,
	0.00000000000022737367544323206000,
	0.00000000000011368683772161603000,
	0.00000000000005684341886080801500,
	0.00000000000002842170943040400700,
	0.00000000000001421085471520200400,
	0.00000000000000710542735760100190,
	0.00000000000000355271367880050090,
	0.00000000000000177635683940025050,
	0.00000000000000088817841970012523,
	0.00000000000000044408920985006262,
	0.00000000000000022204460492503131,
	0.00000000000000011102230246251565,
	0.00000000000000005551115123125782700,
	0.00000000000000002775557561562891400,
	0.00000000000000001387778780781445700,
	0.00000000000000000693889390390722840,
	0.00000000000000000346944695195361420,
	0.00000000000000000173472347597680710,
	0.00000000000000000086736173798840355,
	0.00000000000000000043368086899420177,
	0.00000000000000000021684043449710089,
	0.00000000000000000010842021724855044,
	0.00000000000000000005421010862427522200,
	0.00000000000000000002710505431213761100,
	0.00000000000000000001355252715606880500,
	0.00000000000000000000677626357803440270,
	0.00000000000000000000338813178901720140,
	0.00000000000000000000169406589450860070,
	0.00000000000000000000084703294725430034,
	0.00000000000000000000042351647362715017,
	0.00000000000000000000021175823681357508,
	0.00000000000000000000010587911840678754,
	0.00000000000000000000005293955920339377100,
	0.00000000000000000000002646977960169688600,
	0.00000000000000000000001323488980084844300,
	0.00000000000000000000000661744490042422140,
	0.00000000000000000000000330872245021211070,
	0.00000000000000000000000165436122510605530,
	0.00000000000000000000000082718061255302767,
	0.00000000000000000000000041359030627651384,
	0.00000000000000000000000020679515313825692,
	0.00000000000000000000000010339757656912846,
	0.00000000000000000000000005169878828456423,
	0.00000000000000000000000002584939414228211500,
	0.00000000000000000000000001292469707114105700,
	0.00000000000000000000000000646234853557052870,
	0.00000000000000000000000000323117426778526440,
	0.00000000000000000000000000161558713389263220,
	0.00000000000000000000000000080779356694631609,
	0.00000000000000000000000000040389678347315804,
	0.00000000000000000000000000020194839173657902,
	0.00000000000000000000000000010097419586828951,
	0.00000000000000000000000000005048709793414475600,
	0.00000000000000000000000000002524354896707237800,
	0.00000000000000000000000000001262177448353618900,
	0.00000000000000000000000000000631088724176809440,
	0.00000000000000000000000000000315544362088404720,
	0.00000000000000000000000000000157772181044202360,
	0.00000000000000000000000000000078886090522101181,
	0.00000000000000000000000000000039443045261050590,
	0.00000000000000000000000000000019721522630525295,
	0.00000000000000000000000000000009860761315262647600,
	0.00000000000000000000000000000004930380657631323800,
	0.00000000000000000000000000000002465190328815661900,
	0.00000000000000000000000000000001232595164407830900,
	0.00000000000000000000000000000000616297582203915470,
	0.00000000000000000000000000000000308148791101957740,
	0.00000000000000000000000000000000154074395550978870,
	0.00000000000000000000000000000000077037197775489434,
	0.00000000000000000000000000000000038518598887744717,
	0.00000000000000000000000000000000019259299443872359,
	0.00000000000000000000000000000000009629649721936179,
	0.00000000000000000000000000000000004814824860968090,
	0.00000000000000000000000000000000002407412430484045,
	0.00000000000000000000000000000000001203706215242022,
	0.00000000000000000000000000000000000601853107621011,
	0.00000000000000000000000000000000000300926553810506,
	0.00000000000000000000000000000000000150463276905253,
	0.00000000000000000000000000000000000075231638452626,
	0.00000000000000000000000000000000000037615819226313,
	0.00000000000000000000000000000000000018807909613157,
	0.00000000000000000000000000000000000009403954806578,
	0.00000000000000000000000000000000000004701977403289,
	0.00000000000000000000000000000000000002350988701645,
	0.00000000000000000000000000000000000001175494350822,
	0.0, // Underflow
	0.0, // Underflow
}
